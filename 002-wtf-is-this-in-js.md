# WTF is "this" in Javascript

That topic we should all have learnt straight off the bat but that, for whatever reason, we decided to skip without fully understand it... I know, I am one of you.

## TL;DR

The function "this" keyword in Javascript simply references an object. What is tricky is that the object whose `this` references to can vary depending on the execution context... and that makes it a confusing topic.

## What is "this"

The function "this" keyword in Javascript simply references an object. Which object? It depends on the context in which `this` is called.

[MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this) definition reads as follow:

> A property of an execution context (global, function or eval) that, in nonâ€“strict mode, is always a reference to an object and in strict mode can be any value.

Let's unpack it... shall we?

## What is an execution context?

The execution context is the environment in which a function is executed. Depending on the environment your code will have access to a specific number of *variables*, *objects*, *functions*, etc.

As per the definition you saw above, there are three possible execution context in Javascript:

- the **global execution context** - there can be only one and it is the default execution context for JS code;

- the **functional execution context** - there can be many, they are generated by the JS engine whenever a function call is executed;

- the **eval execution context** - the execution context inside an `eval()` function.

## Let's get our hands a bit dirty

First and foremost, I will not talk about the eval execution context. You may ask why? The answer is simple... because you should never ever use `eval()`... "eval is evil!". If you do not believe me, read it for yourself [here](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval).

With that out of the way, let's focus on functions and the global object.

Btw, in Javascript, [functions are objects](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions). Whether we talk about one or the other... we are always talking about objects.

### Function in the global execution context

For a regular function, called in the global context the `this` keyword will reference the global object itself.

The global object is `window` (browsers) and `global` (node).

> NOTE: You can get the global object from whatever context your code is in just using the global `globalThis` property.

````js
function showMeTheValueOfThis() {
    console.log(this);
}

showmMeTheValueOfThis(); // Window { ... }
````

### Function as a method of an object

If the function is part of an object (or a class) we call it a **method** and the `this` keyword references the object itself.

````js
const book = {
    title: "Title",
    read: function() {
        console.log(this);
    }
};

// also when introducing methods later
book.stop = function() {
    console.log(this);
}

book.read(); // {title: "Title", play: f}
book.stop(); // {title: "Title", play: f}
````

### Function as constructor function or class constructor function

If the function is a constructor function (or a class constructor functions), the `this` keyword will reference the object the function is constructing. To call a constructor function (or create a new instance of an object from a class), we need to use the `new` keyword. This will create a new empty object (`{}`), the value of `this` will be intrinsically given reference to that object.

````js
// constructor functions are conventionally capitalised

function Movie(title) {
    this.title = title;
    console.log(this);
}

const movie = new Movie("Title"); // Movie {title: "Title"}

// same story for a class

class User {
    constructor(name, age) {
        this.name = name;
        this.age = age;
    }

    getAge() {
        console.log(`${this.name} is ${this.age} years old`);
    }
}

const bob = new User("Bob", 36);
bob.getAge(); // Bob is 36 years old
````

### Function as a DOM event handler

````js
somecodehere
````

## Functions in `strict mode`

What happens when a function is executed in `strict mode`? Really, we should never want to have data that are scoped to a function to leak in the outer scope. As we have seen above though, this is very possible... example below.

## Functions VS Arrow functions

`bind()` and arrow functions.
